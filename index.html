<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>職業安全衛生評鑑資料管理系統（完整演示版_含PDCA說明）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        
        /* Tab 樣式 */
        .tab-active { border-bottom: 3px solid #0ea5e9; color: #0284c7; font-weight: 700; background-color: white; }
        .tab-inactive { color: #64748b; font-weight: 500; background-color: #f1f5f9; }
        .tab-inactive:hover { background-color: #e2e8f0; color: #334155; }
        
        /* Checkbox 優化 */
        .custom-checkbox:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        /* 動畫 */
        .fade-in-section { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* 輸入框樣式 */
        .input-readonly { background-color: #f8fafc; color: #475569; cursor: default; border-color: #cbd5e1; border-style: solid; }
        .input-readonly:focus { outline: none; box-shadow: none; border-color: #cbd5e1; }
        .input-editable { background-color: #ffffff; color: #1e293b; border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; transition: all 0.2s; }

        /* Review Input 專用樣式 (管理者審查用) */
        .review-input-locked {
            background-color: transparent; border: none; font-weight: bold; color: #1e293b; width: 100%; pointer-events: none;
        }
        .review-input-unlocked {
            background-color: white; border: 1px solid #3b82f6; border-radius: 0.25rem; padding: 0.25rem 0.5rem; width: 100%; pointer-events: auto;
        }

        /* Demo 說明字卡樣式 */
        .demo-info-card {
            background-color: #fffbeb; border-left: 4px solid #f59e0b; color: #92400e; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); font-size: 0.875rem; line-height: 1.5;
        }
        .demo-info-card strong { font-weight: 700; color: #b45309; }
        .demo-info-card i { color: #f59e0b; margin-right: 0.5rem; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-slate-800">

    <!-- Header -->
    <header class="bg-slate-900 text-white shadow-md z-20 shrink-0">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-shield-halved text-2xl text-blue-400"></i>
                <div>
                    <h1 class="text-lg font-bold tracking-wider">職業安全衛生評鑑資料管理系統</h1>
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest">OSH Evaluation Data Management System (Demo)</p>
                </div>
            </div>
            <div class="text-xs bg-slate-800 px-3 py-1 rounded border border-slate-700">
                <i class="fa-solid fa-user-circle mr-1"></i> 目前使用者：系統管理員
            </div>
        </div>
    </header>

    <!-- Tabs -->
    <nav class="bg-white border-b border-slate-200 shrink-0">
        <div class="container mx-auto px-6 flex space-x-1">
            <button onclick="switchTab('tab2')" id="btn-tab2" class="tab-active px-6 py-3 text-sm transition-colors border-t border-l border-r border-slate-200 rounded-t-lg mt-2 relative top-[1px]">
                <i class="fa-solid fa-file-arrow-up mr-2"></i>顧問資料上傳 (Plan/Do)
            </button>
            <button onclick="switchTab('tab3')" id="btn-tab3" class="tab-inactive px-6 py-3 text-sm transition-colors border-t border-l border-r border-transparent rounded-t-lg mt-2 relative">
                <i class="fa-solid fa-list-check mr-2"></i>管理者總覽 (Check/Act)
                <span class="absolute top-2 right-2 flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                </span>
            </button>
            <button onclick="switchTab('tab1')" id="btn-tab1" class="tab-inactive px-6 py-3 text-sm transition-colors border-t border-l border-r border-transparent rounded-t-lg mt-2">
                <i class="fa-solid fa-magnifying-glass-chart mr-2"></i>評鑑機器人 (Evaluation)
            </button>
            <button onclick="switchTab('tab4')" id="btn-tab4" class="tab-inactive px-6 py-3 text-sm transition-colors border-t border-l border-r border-transparent rounded-t-lg mt-2">
                <i class="fa-solid fa-robot mr-2"></i>文管機器人 (AI輔助)
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow overflow-auto p-6 container mx-auto max-w-7xl relative">

        <!-- ========================================== -->
        <!-- Tab 2: 顧問資料上傳介面 (完整更新版) -->
        <!-- ========================================== -->
        <div id="tab2" class="hidden">
            <div class="max-w-5xl mx-auto bg-white rounded-lg shadow border border-slate-200">
                <div class="p-6 border-b border-slate-200">
                    <h2 class="text-xl font-bold text-slate-800">顧問資料上傳</h2>
                    <p class="text-sm text-slate-500 mt-1">輸入統編與年度，自動帶入歷史執行紀錄資料。</p>
                </div>
                <div class="p-8 space-y-8">
                    
                    <!-- Step 1: 統編與年度輸入 -->
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
                        <label class="block text-base font-bold text-blue-800 mb-4 border-l-4 border-blue-500 pl-2">Step 1：帶入作業場所資料</label>
                        <div class="flex flex-col md:flex-row gap-4 items-end">
                            <div class="w-full md:w-1/3">
                                <label class="block text-sm font-medium text-slate-700 mb-1">統一編號 <span class="text-red-500">*</span></label>
                                <input type="text" id="input-tax-id" class="w-full border-slate-300 rounded shadow-sm text-sm p-2 border" placeholder="請輸入8碼統編" value="12345678">
                            </div>
                            <div class="w-full md:w-1/3">
                                <label class="block text-sm font-medium text-slate-700 mb-1">服務年度 <span class="text-red-500">*</span></label>
                                <select id="input-year" class="w-full border-slate-300 rounded shadow-sm text-sm p-2 border">
                                    <option value="2025">2025 (114年)</option>
                                    <option value="2024" selected>2024 (113年)</option>
                                </select>
                            </div>
                            <div class="w-full md:w-1/3">
                                <button onclick="fetchCompanyData()" class="w-full bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold shadow hover:bg-blue-700 transition">
                                    <i class="fa-solid fa-magnifying-glass mr-2"></i> 確認並帶入資料
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 自動帶入資料區 (預設隱藏) -->
                    <div id="company-data-section" class="hidden space-y-8">
                        
                        <!-- 功能列：資料更新 -->
                        <div class="flex justify-between items-center bg-yellow-50 p-3 rounded-md border border-yellow-200 shadow-sm">
                            <div class="text-sm text-slate-700 flex items-center">
                                <i class="fa-solid fa-file-pdf mr-2 text-red-500"></i> 
                                <span>已帶入資料來源：<span class="font-bold underline">ABCDEF有限公司_勞工健康服務執行紀錄_2024-01-01.pdf</span></span>
                            </div>
                            <button id="edit-btn" onclick="toggleEditMode()" class="bg-white border border-slate-300 text-slate-700 hover:text-blue-600 hover:border-blue-400 px-4 py-1.5 rounded text-sm font-bold shadow-sm transition flex items-center">
                                <i class="fa-solid fa-pen-to-square mr-2"></i> 資料更新 (啟用編輯)
                            </button>
                        </div>

                        <!-- 一、作業場所基本資料 (嚴格對應 PDF) -->
                        <div class="border border-slate-200 rounded-lg overflow-hidden">
                            <div class="bg-slate-50 p-4 border-b border-slate-200">
                                <h3 class="font-bold text-slate-700 text-lg">一、作業場所基本資料</h3>
                            </div>
                            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="md:col-span-2 grid grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">事業單位名稱</label>
                                        <input type="text" class="w-full input-readonly rounded text-sm p-2.5" value="ABCDEF有限公司" readonly>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">部門名稱</label>
                                        <input type="text" class="w-full input-readonly rounded text-sm p-2.5 data-field" value="台南廠" readonly>
                                    </div>
                                </div>
                                
                                <!-- 人員統計區塊 -->
                                <div class="md:col-span-2 bg-white rounded-lg border border-slate-200 p-0 overflow-hidden">
                                    <div class="bg-slate-100 px-4 py-2 border-b border-slate-200">
                                        <span class="text-sm font-bold text-slate-700">勞工人數統計</span>
                                    </div>
                                    <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <!-- 行政人員 -->
                                        <div class="space-y-3">
                                            <div class="flex items-center">
                                                <span class="text-sm font-bold text-slate-700 w-24">行政人員</span>
                                                <div class="flex items-center mr-4">
                                                    <span class="text-sm text-slate-500 mr-2">男</span>
                                                    <input type="number" class="w-20 input-readonly rounded text-sm p-1.5 text-center data-field font-bold" value="30" readonly>
                                                    <span class="text-sm text-slate-500 ml-1">人</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <span class="text-sm text-slate-500 mr-2">女</span>
                                                    <input type="number" class="w-20 input-readonly rounded text-sm p-1.5 text-center data-field font-bold" value="20" readonly>
                                                    <span class="text-sm text-slate-500 ml-1">人</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 作業人員 -->
                                        <div class="space-y-3">
                                            <div class="flex items-center">
                                                <span class="text-sm font-bold text-slate-700 w-24">現場操作人員</span>
                                                <div class="flex items-center mr-4">
                                                    <span class="text-sm text-slate-500 mr-2">男</span>
                                                    <input type="number" class="w-20 input-readonly rounded text-sm p-1.5 text-center data-field font-bold" value="40" readonly>
                                                    <span class="text-sm text-slate-500 ml-1">人</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <span class="text-sm text-slate-500 mr-2">女</span>
                                                    <input type="number" class="w-20 input-readonly rounded text-sm p-1.5 text-center data-field font-bold" value="20" readonly>
                                                    <span class="text-sm text-slate-500 ml-1">人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 特別危害健康作業 -->
                                    <div class="bg-slate-50 px-4 py-3 border-t border-slate-200">
                                        <div class="flex flex-wrap items-center gap-4">
                                            <span class="text-sm font-bold text-slate-700"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-1"></i> 特別危害健康作業</span>
                                            <div class="flex items-center bg-white border border-slate-300 px-3 py-1 rounded-full">
                                                <span class="text-xs text-slate-500 mr-2">1. 高溫</span>
                                                <input type="number" class="w-12 text-center text-sm font-bold input-readonly data-field p-0 border-none bg-transparent" value="5" readonly>
                                                <span class="text-xs text-slate-500">人</span>
                                            </div>
                                            <div class="flex items-center bg-white border border-slate-300 px-3 py-1 rounded-full">
                                                <span class="text-xs text-slate-500 mr-2">2. 噪音</span>
                                                <input type="number" class="w-12 text-center text-sm font-bold input-readonly data-field p-0 border-none bg-transparent" value="20" readonly>
                                                <span class="text-xs text-slate-500">人</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 二、作業場所與勞動條件概況 -->
                        <div class="border border-slate-200 rounded-lg overflow-hidden">
                            <div class="bg-slate-50 p-4 border-b border-slate-200">
                                <h3 class="font-bold text-slate-700 text-lg">二、作業場所與勞動條件概況</h3>
                            </div>
                            
                            <div class="p-6 space-y-5">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-1">1. 工作流程 (製程)</label>
                                    <textarea class="w-full input-readonly rounded text-sm p-3 data-field min-h-[60px]" readonly>整經漿紗->織布->脫漿->成布加工->品質檢驗->儲運。</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-1">2. 工作型態與時間</label>
                                    <textarea class="w-full input-readonly rounded text-sm p-3 data-field min-h-[60px]" readonly>行政人員常日班,產線人員輪值三班。</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-1">3. 人員及危害特性概述</label>
                                    <textarea class="w-full input-readonly rounded text-sm p-3 data-field min-h-[80px]" readonly>潛在工作危害特性:高溫、噪音、人因性危害、精密作業、長時間夜間工作、切割捲夾。</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2 臨場服務項目 -->
                        <div class="bg-white p-6 rounded-lg border border-blue-200 shadow-sm">
                            <label class="block text-base font-bold text-blue-800 mb-4 border-l-4 border-blue-500 pl-2">Step 2：臨場服務項目勾選 (本規則第九條至第十三條事項)</label>
                            
                            <!-- 核心必要紀錄 -->
                            <div class="mb-4 pb-4 border-b border-slate-100">
                                <label class="flex items-center space-x-3 p-3 bg-blue-50 border border-blue-200 rounded-md shadow-sm hover:bg-blue-100 cursor-pointer transition">
                                    <input type="checkbox" class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500 custom-checkbox" checked>
                                    <span class="font-bold text-blue-900">勞工健康服務執行紀錄表 <span class="text-red-500 text-xs ml-1">(必要)</span></span>
                                </label>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-1 勞工體格(健康)檢查結果分析與評估。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-2 勞工適性工作評估與配置建議。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-3 健康檢查異常追蹤與健康指導。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-4 特別危害健康作業勞工管理。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-5 職業傷病與健康相關資料保存。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-6 健康教育、衛生指導與健康促進。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-7 工作相關傷病之預防、健康諮詢與急救及緊急處置。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">9-8 定期向雇主報告及勞工健康服務之建議。</span></label>
                                <div class="col-span-full border-t border-slate-100 my-1"></div>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">11-1 辨識與評估工作場所危害因子。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">11-2 提出作業環境安全衛生設施改善規劃。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">11-3 調查勞工健康情形與作業之關連性。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">11-4 提供復工勞工之職能評估、職務再設計。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">11-5 其他經中央主管機關指定公告者。</span></label>
                                <div class="col-span-full border-t border-slate-100 my-1"></div>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">12 訂定勞工健康服務計畫。</span></label>
                                <label class="flex items-start space-x-2 p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" class="mt-1 custom-checkbox rounded text-blue-600" checked><span class="text-slate-700">13 訂定勞工健康管理方案。</span></label>
                            </div>
                             <div class="mt-4 pt-4 border-t border-slate-200">
                                <label class="flex items-center space-x-3 p-2 hover:bg-slate-50 rounded cursor-pointer text-slate-600">
                                    <input type="checkbox" class="w-4 h-4 text-slate-500 rounded border-gray-300 custom-checkbox">
                                    <span class="text-sm font-medium">其他附件或證明文件</span>
                                </label>
                            </div>
                        </div>

                        <!-- 上傳區 -->
                        <div class="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center bg-slate-50 hover:bg-white transition cursor-pointer">
                            <i class="fa-solid fa-cloud-arrow-up text-3xl text-slate-400 mb-2"></i>
                            <p class="text-sm font-medium text-slate-600">點擊上傳 PDF 文件</p>
                            <p class="text-xs text-slate-400 mt-1">請上傳已用印之正式文件以供評鑑佐證</p>
                        </div>

                        <div class="flex justify-end pt-4 border-t border-slate-100">
                            <button class="bg-blue-600 text-white px-8 py-2.5 rounded text-sm font-bold shadow hover:bg-blue-700 transition">
                                <i class="fa-regular fa-paper-plane mr-2"></i> 確認上傳
                            </button>
                        </div>
                    </div> 
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Tab 3: 管理者總覽 (Check/Act) -->
        <!-- ========================================== -->
        <div id="tab3" class="hidden">
            
            <!-- Demo 說明字卡 (Check & Act) -->
            <div class="demo-info-card">
                <i class="fa-solid fa-gavel"></i>
                <strong>PDCA 設計理念：Check & Act (查核與行動) —— 缺口管理與歸檔審查</strong><br>
                此介面包含兩大核心功能：<br>
                1. <strong>缺口分析 (Check)</strong>：即時比對法規要求與執行現況，以紅燈標示缺件。<br>
                2. <strong>歸檔審查 (Act)</strong>：針對文管機器人傳送的待辦項目進行「人機協作」審核。管理者可預覽原始文件並修正 AI 判讀結果，確保每一筆寫入資料庫的紀錄皆符合合規標準（Gatekeeping）。
            </div>

            <!-- 待歸檔資料通知區 -->
            <div class="mb-8">
                <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                    <span class="bg-red-500 w-2 h-6 mr-2 rounded-full"></span>
                    待歸檔資料通知
                    <span class="ml-2 bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full">3 筆待辦</span>
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Notification Card 1 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-blue-500 cursor-pointer hover:shadow-md transition group" onclick="openArchivingReview('ABCDEF有限公司', '2024', '9-2 適性評估')">
                        <div class="flex justify-between items-start mb-2">
                            <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded">AI 建議</span>
                            <span class="text-xs text-slate-400">10 分鐘前</span>
                        </div>
                        <h4 class="font-bold text-slate-800 text-lg group-hover:text-blue-600 transition">ABCDEF有限公司</h4>
                        <div class="mt-2 text-sm text-slate-500 space-y-1">
                            <p><i class="fa-regular fa-calendar mr-2 w-4"></i>2024 年度</p>
                            <p><i class="fa-solid fa-tag mr-2 w-4"></i>9-2 適性評估</p>
                        </div>
                        <div class="mt-3 pt-3 border-t border-slate-100 text-center text-xs text-blue-500 font-bold group-hover:underline">
                            點擊進行審查與歸檔 <i class="fa-solid fa-arrow-right ml-1"></i>
                        </div>
                    </div>
                    <!-- Notification Card 2 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-blue-500 cursor-pointer hover:shadow-md transition group" onclick="openArchivingReview('XYZ物流中心', '2024', '9-3 異常追蹤')">
                        <div class="flex justify-between items-start mb-2"><span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded">AI 建議</span><span class="text-xs text-slate-400">2 小時前</span></div>
                        <h4 class="font-bold text-slate-800 text-lg group-hover:text-blue-600 transition">XYZ物流中心</h4>
                        <div class="mt-2 text-sm text-slate-500 space-y-1"><p><i class="fa-regular fa-calendar mr-2 w-4"></i>2024 年度</p><p><i class="fa-solid fa-tag mr-2 w-4"></i>9-3 異常追蹤</p></div>
                        <div class="mt-3 pt-3 border-t border-slate-100 text-center text-xs text-blue-500 font-bold group-hover:underline">點擊進行審查與歸檔 <i class="fa-solid fa-arrow-right ml-1"></i></div>
                    </div>
                    <!-- Notification Card 3 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-purple-500 cursor-pointer hover:shadow-md transition group" onclick="openArchivingReview('TopTech電子', '2025', '11-1 危害辨識')">
                        <div class="flex justify-between items-start mb-2"><span class="bg-purple-100 text-purple-700 text-[10px] font-bold px-2 py-0.5 rounded">人工上傳</span><span class="text-xs text-slate-400">昨天</span></div>
                        <h4 class="font-bold text-slate-800 text-lg group-hover:text-blue-600 transition">TopTech電子</h4>
                        <div class="mt-2 text-sm text-slate-500 space-y-1"><p><i class="fa-regular fa-calendar mr-2 w-4"></i>2025 年度</p><p><i class="fa-solid fa-tag mr-2 w-4"></i>11-1 危害辨識</p></div>
                        <div class="mt-3 pt-3 border-t border-slate-100 text-center text-xs text-blue-500 font-bold group-hover:underline">點擊進行審查與歸檔 <i class="fa-solid fa-arrow-right ml-1"></i></div>
                    </div>
                </div>
            </div>

            <!-- 原有表格 -->
            <div class="bg-white rounded-lg shadow border border-slate-200 overflow-hidden">
                <div class="p-6 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                    <h2 class="text-xl font-bold text-slate-800">各事業單位評鑑資料完成度總覽</h2>
                    <div class="flex space-x-2">
                        <span class="text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded">可評鑑: 12</span>
                        <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">未完成: 3</span>
                    </div>
                </div>
                <div class="p-6">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-500 font-bold">
                            <tr><th class="px-6 py-3">事業單位</th><th class="px-6 py-3">年度</th><th class="px-6 py-3">已完成項目數</th><th class="px-6 py-3">缺件項目</th><th class="px-6 py-3">狀態</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr class="hover:bg-slate-50"><td class="px-6 py-4 font-bold text-slate-700">ABCDEF有限公司</td><td class="px-6 py-4">2024</td><td class="px-6 py-4">15 / 15</td><td class="px-6 py-4 text-green-500">無</td><td class="px-6 py-4"><span class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded text-xs font-bold">資料齊備</span></td></tr>
                            <tr class="hover:bg-slate-50"><td class="px-6 py-4 font-bold text-slate-700">XYZ 物流中心</td><td class="px-6 py-4">2024</td><td class="px-6 py-4">2 / 6</td><td class="px-6 py-4 text-red-500">9-2, 9-3</td><td class="px-6 py-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold">未完成</span></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Tab 1: 評鑑機器人 (Evaluation) -->
        <!-- ========================================== -->
        <div id="tab1" class="hidden">
            <div id="search-view" class="flex flex-col items-center justify-center h-full transition-all duration-500">
                <div class="w-full max-w-2xl text-center space-y-6">
                    <!-- Demo 說明字卡 -->
                    <div class="demo-info-card text-left">
                        <i class="fa-solid fa-magnifying-glass-chart"></i>
                        <strong>PDCA 設計理念：Evaluation (評鑑) —— 智慧調閱與可追溯性</strong><br>
                        此介面運用 AI 語意分析技術，允許稽核人員透過自然語言指令即時調閱歷史紀錄。系統將非結構化的訪視紀錄轉化為可量化的法規完成度指標，且所有欄位皆可點擊追溯至原始 PDF 附件，確保資料的真實性與不可否認性。
                    </div>

                    <div class="bg-blue-50 p-4 rounded-full inline-block mb-2"><i class="fa-solid fa-robot text-4xl text-blue-600"></i></div>
                    <h2 class="text-2xl font-bold text-slate-700">評鑑資料AI查詢助手</h2>
                    <div class="relative group text-left">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none"><i class="fa-solid fa-search text-slate-400"></i></div>
                        <input type="text" id="search-input" class="block w-full p-4 pl-12 text-sm border border-slate-300 rounded-lg shadow-sm" placeholder="請輸入查詢指令" value="ABCDEF有限公司 2024 年臨場健康服務評鑑資料">
                        <button onclick="performSearch()" class="absolute right-2.5 bottom-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm px-4 py-2 shadow">查詢調閱</button>
                    </div>
                </div>
            </div>
            <div id="report-view" class="hidden pb-12">
                <div class="flex justify-between items-center mb-6">
                    <button onclick="resetSearch()" class="text-slate-500 hover:text-blue-600 text-sm flex items-center"><i class="fa-solid fa-arrow-left mr-2"></i> 返回重新查詢</button>
                    <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full border border-emerald-200"><i class="fa-solid fa-check-circle mr-1"></i> 查詢完成</span>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden p-8 text-center text-slate-500">
                    （評鑑報告內容，包含案件基本資訊、項目狀態與佐證文件，省略以節省篇幅）
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- Tab 4: 文管機器人 (AI Support) -->
        <!-- ========================================== -->
        <div id="tab4" class="hidden">
            <div class="flex flex-col items-center justify-center h-full max-w-3xl mx-auto">
                
                <!-- Demo 說明字卡 (AI) -->
                <div class="demo-info-card w-full mb-8">
                    <i class="fa-solid fa-microchip"></i>
                    <strong>PDCA 設計理念：AI Support (智能輔助) —— 資料攝取中心</strong><br>
                    此為系統的「資料入口」。AI 僅作為「分類助手」而非決策者，負責對掃描文件進行 OCR 辨識與屬性預判。所有資料皆需傳送至「管理者總覽」進行人工確認（Human-in-the-Loop），確保資料進入正式資料庫前的準確性。
                </div>

                <div class="bg-white p-10 rounded-xl shadow-lg border border-slate-200 w-full text-center">
                    <div class="mb-6">
                        <div class="bg-indigo-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-cloud-arrow-up text-4xl text-indigo-500"></i>
                        </div>
                        <h3 class="font-bold text-2xl text-slate-800 mb-2">文管機器人 - 資料攝取中心</h3>
                        <p class="text-slate-500">請將掃描後的 PDF 文件拖曳至此，系統將自動進行 OCR 辨識與分類，<br>並傳送至「管理者總覽」等待人工確認歸檔。</p>
                    </div>
                    
                    <div class="border-2 border-dashed border-indigo-200 bg-indigo-50/50 rounded-xl p-12 cursor-pointer hover:bg-indigo-50 transition-colors group" onclick="simulateDocAnalysis()">
                        <p class="font-bold text-indigo-800 text-lg group-hover:scale-105 transition-transform">點擊此處模擬上傳文件</p>
                        <p class="text-xs text-indigo-400 mt-2">支援格式：PDF, JPG, PNG (Max 20MB)</p>
                    </div>

                    <div id="upload-success-msg" class="hidden mt-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded flex items-center justify-center">
                        <i class="fa-solid fa-circle-check mr-2"></i>
                        <span>上傳成功！資料已傳送至管理者待辦清單，請前往「管理者總覽」進行歸檔確認。</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- 歸檔審查 Modal -->
    <div id="archiving-modal" class="fixed inset-0 bg-slate-900 bg-opacity-75 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-lg shadow-2xl flex flex-col overflow-hidden animate-fade-in-up transform transition-all">
            <div class="bg-slate-800 text-white px-6 py-4 flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg"><i class="fa-solid fa-file-signature mr-2"></i>資料歸檔審查</h3>
                <button onclick="closeArchivingModal()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-8 bg-slate-50">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 text-sm text-blue-900">
                    <div class="flex items-start">
                        <i class="fa-solid fa-robot mt-1 mr-3 text-blue-500"></i>
                        <div>
                            <p class="font-bold">AI 預判分類結果</p>
                            <p>系統依據文件內容自動填寫以下欄位，請管理者確認是否正確。如需調整，請點擊「修改」按鈕。</p>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">事業單位</label><input type="text" id="review-company" class="review-input-locked" value="ABCDEF有限公司" readonly></div>
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">歸檔年度</label><input type="text" id="review-year" class="review-input-locked" value="2024" readonly></div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">歸檔類別</label>
                        <div class="flex items-center"><input type="text" id="review-category" class="review-input-locked" value="9-2 適性評估" readonly><span class="ml-2 text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded border border-green-200" id="confidence-badge">信心度 98%</span></div>
                    </div>
                </div>
            </div>
            <div class="bg-white border-t border-slate-200 p-6 flex space-x-4">
                <button id="btn-modify" onclick="toggleArchivingEdit()" class="flex-1 bg-white border border-slate-300 text-slate-700 px-4 py-2.5 rounded text-sm font-bold hover:bg-slate-50 hover:text-blue-600 transition flex items-center justify-center"><i class="fa-solid fa-pen-to-square mr-2"></i> 修改</button>
                <button onclick="openPdfModal('待審文件.pdf')" class="flex-1 bg-white border border-slate-300 text-slate-700 px-4 py-2.5 rounded text-sm font-bold hover:bg-slate-50 hover:text-blue-600 transition flex items-center justify-center"><i class="fa-solid fa-eye mr-2"></i> 預覽文件</button>
                <button onclick="confirmArchiving()" class="flex-[1.5] bg-indigo-600 text-white px-4 py-2.5 rounded text-sm font-bold hover:bg-indigo-700 shadow-md transition flex items-center justify-center"><i class="fa-solid fa-check mr-2"></i> 確認並歸檔</button>
            </div>
        </div>
    </div>

    <!-- PDF Modal (預覽用) -->
    <div id="pdf-modal" class="fixed inset-0 bg-slate-900 bg-opacity-75 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-4xl h-[80vh] rounded-lg shadow-2xl flex flex-col overflow-hidden">
            <div class="bg-slate-800 text-white px-4 py-3 flex justify-between items-center shrink-0">
                <h3 class="font-bold text-sm" id="modal-title">文件預覽</h3>
                <button onclick="closePdfModal()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="flex-grow bg-slate-100 flex flex-col items-center justify-center p-8">
                <i class="fa-regular fa-file-pdf text-6xl text-slate-300 mb-4"></i>
                <p class="text-slate-400 font-bold text-lg">PDF 文件預覽區 (Demo)</p>
            </div>
            <div class="bg-white border-t border-slate-200 p-3 text-right shrink-0">
                <button onclick="closePdfModal()" class="bg-slate-600 text-white px-4 py-2 rounded text-sm hover:bg-slate-700">關閉視窗</button>
            </div>
        </div>
    </div>

    <script>
        // Tab 切換
        function switchTab(tabId) {
            ['tab1', 'tab2', 'tab3', 'tab4'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
                document.getElementById(id).classList.remove('h-full', 'flex', 'flex-col');
            });
            const target = document.getElementById(tabId);
            target.classList.remove('hidden');
            if(tabId === 'tab1' || tabId === 'tab2' || tabId === 'tab4') target.classList.add('h-full', 'flex', 'flex-col');
            
            ['btn-tab1', 'btn-tab2', 'btn-tab3', 'btn-tab4'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btnId === 'btn-' + tabId) {
                    btn.classList.add('tab-active', 'border-slate-200');
                    btn.classList.remove('tab-inactive', 'border-transparent');
                } else {
                    btn.classList.remove('tab-active', 'border-slate-200');
                    btn.classList.add('tab-inactive', 'border-transparent');
                }
            });
        }

        // Tab 2: 顧問資料上傳邏輯
        function fetchCompanyData() {
            const taxId = document.getElementById('input-tax-id').value.trim();
            if (taxId === '12345678') {
                const btn = event.currentTarget;
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> 查詢中...';
                btn.disabled = true;
                setTimeout(() => {
                    document.getElementById('company-data-section').classList.remove('hidden');
                    document.getElementById('company-data-section').classList.add('fade-in-section');
                    btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i> 資料已帶入';
                    btn.classList.replace('bg-blue-600', 'bg-emerald-600');
                    setTimeout(() => { btn.disabled = false; btn.innerHTML = originalHtml; btn.classList.replace('bg-emerald-600', 'bg-blue-600'); }, 2000);
                }, 800);
            } else {
                alert('查無此統編資料 (Demo: 請輸入 12345678)');
            }
        }

        // Tab 2: 編輯模式切換
        let isEditMode = false;
        function toggleEditMode() {
            const btn = document.getElementById('edit-btn');
            const fields = document.querySelectorAll('.data-field');
            isEditMode = !isEditMode;
            if (isEditMode) {
                fields.forEach(field => { field.readOnly = false; field.classList.remove('input-readonly'); field.classList.add('input-editable'); });
                btn.innerHTML = '<i class="fa-solid fa-save mr-2"></i> 儲存變更';
                btn.classList.replace('bg-white', 'bg-blue-600'); btn.classList.replace('text-slate-700', 'text-white'); btn.classList.replace('border-slate-300', 'border-blue-600');
            } else {
                fields.forEach(field => { field.readOnly = true; field.classList.remove('input-editable'); field.classList.add('input-readonly'); });
                btn.innerHTML = '<i class="fa-solid fa-pen-to-square mr-2"></i> 資料更新 (啟用編輯)';
                btn.classList.replace('bg-blue-600', 'bg-white'); btn.classList.replace('text-white', 'text-slate-700'); btn.classList.replace('border-blue-600', 'border-slate-300');
                alert('系統訊息：資料已更新並暫存。');
            }
        }

        // Tab 1: 評鑑機器人
        function performSearch() {
            if(document.getElementById('search-input').value.trim() !== "") {
                document.getElementById('search-view').classList.add('hidden');
                document.getElementById('report-view').classList.remove('hidden');
            }
        }
        function resetSearch() {
            document.getElementById('report-view').classList.add('hidden');
            document.getElementById('search-view').classList.remove('hidden');
        }

        // Tab 4: 文管機器人 (簡化版 - 僅上傳)
        function simulateDocAnalysis() {
            // 模擬上傳延遲
            document.body.style.cursor = 'wait';
            setTimeout(() => {
                document.body.style.cursor = 'default';
                document.getElementById('upload-success-msg').classList.remove('hidden');
                // 3秒後隱藏訊息
                setTimeout(() => { document.getElementById('upload-success-msg').classList.add('hidden'); }, 3000);
            }, 800);
        }

        // Tab 3: 歸檔審查邏輯 (Modal)
        let isReviewEditing = false;
        
        function openArchivingReview(company, year, category) {
            // 帶入資料
            document.getElementById('review-company').value = company;
            document.getElementById('review-year').value = year;
            document.getElementById('review-category').value = category;
            
            // 重置編輯狀態
            isReviewEditing = false;
            updateReviewFieldsState();
            
            document.getElementById('archiving-modal').classList.remove('hidden');
        }

        function closeArchivingModal() {
            document.getElementById('archiving-modal').classList.add('hidden');
        }

        function toggleArchivingEdit() {
            isReviewEditing = !isReviewEditing;
            updateReviewFieldsState();
        }

        function updateReviewFieldsState() {
            const inputs = ['review-company', 'review-year', 'review-category'];
            const btn = document.getElementById('btn-modify');
            
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if (isReviewEditing) {
                    el.readOnly = false;
                    el.classList.remove('review-input-locked');
                    el.classList.add('review-input-unlocked');
                } else {
                    el.readOnly = true;
                    el.classList.remove('review-input-unlocked');
                    el.classList.add('review-input-locked');
                }
            });

            if (isReviewEditing) {
                btn.innerHTML = '<i class="fa-solid fa-save mr-2"></i> 儲存';
                btn.classList.add('bg-blue-50', 'text-blue-600', 'border-blue-400');
            } else {
                btn.innerHTML = '<i class="fa-solid fa-pen-to-square mr-2"></i> 修改';
                btn.classList.remove('bg-blue-50', 'text-blue-600', 'border-blue-400');
            }
        }

        function confirmArchiving() {
            alert('系統訊息：\n\n已成功歸檔！\n資料已寫入正式資料庫並產生稽核紀錄。');
            closeArchivingModal();
        }

        // PDF Preview Modal
        function openPdfModal(filename) {
            document.getElementById('modal-title').innerText = "預覽：" + filename;
            document.getElementById('pdf-modal').classList.remove('hidden');
        }
        function closePdfModal() {
            document.getElementById('pdf-modal').classList.add('hidden');
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('tab2');
        });
    </script>
</body>
</html>
